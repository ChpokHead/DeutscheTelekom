<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link href="/static/css/employeePage.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid">
    <div class="row flex-nowrap">
        <div class="col py-3">
            <h1>Личный кабинет</h1>
            <p th:text = "${driver.firstName} + ' ' + ${driver.lastName}"></p>
            <div th:switch="${driver.status}">
                <p th:case = "0" th:text="'Статус' + ': ' + 'Отдых'"></p>
                <p th:case = "1" th:text="'Статус' + ': ' + 'Второй водитель'"></p>
                <p th:case = "2" th:text="'Статус' + ': ' + 'За рулем'"></p>
            </div>
            <div th:if="${shiftworkers != null}">
                <p>Соводители: </p>
                <div th:each="shiftworker : ${shiftworkers}">
                    <p th:text="'#' + ${shiftworker.personalNumber} + ' ' + ${shiftworker.firstName} + ' ' + ${shiftworker.lastName}"></p>
                </div>
            </div>
            <div th:if="${shiftworkers == null}">
                <p>Соводителей нет.</p>
            </div>
            <p th:text="'Личный номер фуры: ' + ${driver.currentTruck.regNumber}"></p>
            <div th:if="${driver.currentOrder == null}">
                <p>Заказов нет</p>
            </div>
            <div th:if="${driver.currentOrder != null}">
                <p th:text="'Номер заказа: ' + ${driver.currentOrder.id}"></p>
                <p th:text="'Маршрутные точки: '">
                <div th:each="waypoint : ${driver.currentOrder.waypoints}">
                    <div class="row">
                        <div class="col-3">
                            <p th:text="'#' + ${waypoint.id} + ' ' + ${waypoint.location.name}"></p>
                        </div>
                        <div class="col">
                            <div th:switch="${waypoint.type.toString()}">
                                <p th:case="'SHIPPING'">Тип: Отправка</p>
                                <p th:case="'LOADING'">Тип: Погрузка</p>
                            </div>
                        </div>
                    </div>
                </div>
                </p>
            </div>

        </div>
        <div class="col py-3">
            <div class="row">
                <div class="col py-3">
                    <button id = "status-change-btn" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#changeModal">Изменить статус водителя</button>
                    <div class="modal fade" id="changeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <form th:method="put" id="changeStatus" th:action="@{/driverPage}" th:object="${driver}">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="addModalLabel">Изменение статуса водителя</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <input type="hidden"  th:value="*{personalNumber}" th:field = "*{personalNumber}">
                                            <label for="inputUpdateStatus" class="form-label">Текущий статус</label>
                                            <select class="form-select" aria-label="Текущий статус" id="inputUpdateStatus" th:value="*{status}" th:field="*{status}">
                                                <option value="0">Отдых</option>
                                                <option value="1">Второй водитель</option>
                                                <option value="2">За рулем</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                                        <button type="submit"  class="btn btn-primary" form="changeStatus">Изменить</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row" th:if="${driver.currentOrder != null}">
                <div class="col py-3">
                    <button id = "order-status-change-btn" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#changeOrderModal">Изменить статус заказа</button>
                    <div class="modal fade" id="changeOrderModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <form th:method="put" id="changeOrderStatus" th:action="@{/driverPage/updateOrder}" th:object="${driver}">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="changeOrderModalLabel">Изменение статуса заказа</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <input type="hidden" th:field = "${driver.personalNumber}"/>

                                            <div th:each="waypoint, idx : ${driver.currentOrder.waypoints}">
                                                <input type="hidden" th:field = "${driver.currentOrder.waypoints[__${idx.index}__].id}"/>
                                                <div class="row py-1">
                                                    <div class="col-3">
                                                        <p th:text="'#' + ${waypoint.id} + ' ' + ${waypoint.location.name}"></p>
                                                    </div>
                                                    <div class="col">
                                                        <div th:switch="${waypoint.type.toString()}">
                                                            <p th:case="'SHIPPING'">Тип: Отправка</p>
                                                            <p th:case="'LOADING'">Тип: Погрузка</p>
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        <select class="form-select" th:field="${driver.currentOrder.waypoints[__${idx.index}__].isDone}">
                                                            <option th:value="${true}">Выполнено</option>
                                                            <option th:value="${false}">Не выполнено</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                                        <button type="submit"  class="btn btn-primary" form="changeOrderStatus">Изменить</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="row" th:if="${driver.currentOrder != null}">
                <div class="col py-3">
                    <button id = "order-completion-change-btn" class="btn btn-success btn-lg" th:disabled="${not orderCompleted}" data-bs-toggle="modal" data-bs-target="#changeOrderCompletionModal">Завершить заказ</button>
                    <div class="modal fade" id="changeOrderCompletionModal" tabindex="-1" aria-labelledby="changeOrderCompletionModalLabel" aria-hidden="true">
                        <form th:action="@{/driverPage/completeOrder}" th:method="put" id="orderComplete" th:object="${driver}">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="changeOrderCompletionModalLabel">Завершение заказа</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <input type="hidden" th:field = "${driver.personalNumber}"/>
                                        <input type="hidden" th:value="${driver.currentOrder.id}" th:field = "${driver.currentOrder.id}"/>
                                        <input type="hidden" id="order-complete-id" th:field = "${driver.currentOrder.isCompleted}"/>

                                        Пожалуйста, подтвердите завершение заказа.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                                        <button type="submit"  class="btn btn-primary" form="orderComplete">Завершить заказ</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <row class="py-3">
                <a class="btn btn-lg btn-danger" href="/logout">
                    <span>Выйти</span>
                </a>
            </row>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script th:inline="javascript" type="text/javascript">
    $("#order-completion-change-btn").click(function () {
        $('#order-complete-id').val(true);
    });
</script>
</body>
</html>